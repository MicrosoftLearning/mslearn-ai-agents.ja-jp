---
lab:
  title: VS Code 拡張機能を使用して AI エージェントを開発する
  description: Azure AI Foundry VS Code 拡張機能を使用して AI エージェントを作成します。
---

# VS Code 拡張機能を使用して AI エージェントを開発する

この演習では、Azure AI Foundry VS Code 拡張機能を使用して、モデル コンテキスト プロトコル (MCP) サーバー ツールを使用して外部データ ソースと API にアクセスできるエージェントを作成します。 エージェントは MCP ツールを使用して、最新情報を取得したり、さまざまなサービスと対話したりすることができます。

この演習の所要時間は約 **30** 分です。

> **注**: この演習で使用されるテクノロジの一部は、プレビューの段階または開発中の段階です。 予期しない動作、警告、またはエラーが発生する場合があります。

## 前提条件

この演習を開始するには、以下のものが必要です。
- Visual Studio Code がインストールされていること
- 有効な Azure サブスクリプション

## Azure AI Foundry VS Code 拡張機能をインストールする

VS Code 拡張機能をインストールして設定することから始めましょう。

1. Visual Studio Code を開きます。

1. 左側のペインから **[拡張機能]** を選択します (または **Ctrl + Shift + X** キーを押します)。

1. 検索バーに「**Azure AI Foundry**」と入力し、Enter キーを押します。

1. Microsoft から **[Azure AI Foundry]** 拡張機能を選択し、**[インストール]** をクリックします。

1. インストールが完了したら、Visual Studio Code の左側のプライマリ ナビゲーション バーに拡張機能が表示されていることを確認します。

## Azure にサインインしてプロジェクトを作成する

次に、Azure リソースに接続し、新しい AI Foundry プロジェクトを作成します。

1. VS Code サイド バーで、**[Azure AI Foundry]** 拡張機能アイコンを選択します。

1. [Azure リソース] ビューで、**[Azure にサインイン...]** を選択し、認証プロンプトに従います。

1. サインインした後、ドロップダウンから Azure サブスクリプションを選択します。

1. Azure AI Foundry 拡張機能ビューで **[リソース]** の横にある** +** (プラス) アイコンを選択して、新しい Azure AI Foundry プロジェクトを作成します。

1. 新しいリソース グループを作成するか、既存のリソース グループを使用するかを選択します。
   
   **新しいリソース グループを作成する場合:**
   - **[新しいリソース グループの作成]** を選択し、Enter キーを押します
   - リソース グループの名前 (例: "rg-ai-agents-lab") を入力し、Enter キーを押します
   - 使用可能なオプションから場所を選択し、Enter キーを押します
   
   **既存のリソース グループを使用する場合:**
   - 使用するリソース グループを一覧から選択し、Enter キーを押します

1. テキストボックスに Azure AI Foundry プロジェクトの名前 (例: "ai-agents-project") を入力し、Enter キーを押します。

1. プロジェクトのデプロイが完了するまで待ちます。 ポップアップが表示され、"プロジェクトが正常にデプロイされました" というメッセージが表示されます。

## モデルをデプロイする

エージェントで使用するには、デプロイされたモデルが必要です。

1. "プロジェクトが正常にデプロイされました" というポップアップが表示されたら、**[モデルのデプロイ]** ボタンを選択します。 これにより、モデル カタログが開きます。

   > **ヒント**: [リソース] セクションで **[モデル]** の横にある ** +** アイコンを選択するか、**F1** キーを押して、コマンド **Azure AI Foundry: Open Model Catalog**を実行して、モデル カタログにアクセスすることもできます。

1. モデル カタログで、**[gpt-4o]** モデルを見つけます (検索バーを使用すると、すばやく見つけることができます)。

    ![Azure AI Foundry VS Code 拡張機能のモデル カタログのスクリーンショット。](media/vs-code-model.png)

1. gpt-4o モデルの横にある **[Azure にデプロイ]** を選択します。

1. デプロイ設定を構成します。
   - **デプロイ名**:"gpt-4o-deployment" のような名前を入力します
   - **デプロイの種類**:**[グローバル標準]** (グローバル標準を使用できない場合は **[標準]**) を選択します
   - **モデルのバージョン**: デフォルトのままにする
   - **1 分あたりのトークン数**:デフォルトのままにする

1. 左下隅にある **[Azure AI Foundry にデプロイ]** を選択します。

1. 確認ダイアログで **[デプロイ]** を選択して、モデルをデプロイします。

1. デプロイが完了するまで待ちます。 デプロイしたモデルが、[リソース] ビューの **[モデル]** セクションに表示されます。

## デザイナー ビューを使用して AI エージェントを作成する

次に、ビジュアル デザイナー インターフェイスを使用して AI エージェントを作成します。

1. Azure AI Foundry 拡張機能ビューで、**[リソース]** セクションを見つけます。

1. **[エージェント]** サブセクションの横にある** +** (プラス) アイコンを選択して、新しい AI エージェントを作成します。

    ![Azure AI Foundry VS Code 拡張機能でのエージェントの作成を示すスクリーンショット。](media/vs-code-new-agent.png)

1. プロンプトが表示されたら、エージェント ファイルを保存する場所を選択します。

1. エージェント デザイナー ビューが開き、`.yaml` 構成ファイルが表示されます。

### デザイナーでエージェントを構成する

1. エージェント デザイナーで、次のフィールドを構成します。
   - **[名前]**: エージェントのわかりやすい名前を入力します (例: "data-research-agent")
   - **[説明]**: エージェントの目的を説明する説明を追加します
   - **モデル**:ドロップダウンから GPT-4o デプロイを選択します
   - **手順**:次のようなシステム命令を入力します。
     ```
     You are an AI agent that helps users research information from various sources. Use the available tools to access up-to-date information and provide comprehensive responses based on external data sources.
     ```

1. VS Code メニュー バーから **[ファイル] > [保存]** を選択して、構成を保存します。

## MCP サーバー ツールをエージェントに追加する

次に、エージェントが外部 API とデータ ソースにアクセスできるようにするモデル コンテキスト プロトコル (MCP) サーバー ツールを追加します。

1. デザイナーの **[ツール]** セクションで、右上隅にある **[ツールの追加]** ボタンを選択します。

![Azure AI Foundry VS Code 拡張機能でのエージェントへのツールの追加を示すスクリーンショット。](media/vs-code-agent-tools.png)

1. ドロップダウン メニューから、**[MCP サーバー]** を選択します。

1. 次の情報を使用して MCP サーバー ツールを構成します。
   - **サーバー URL**:MCP サーバーの URL を入力します (例: `https://gitmcp.io/Azure/azure-rest-api-specs`)
   - **サーバー ラベル**:一意識別子を入力します (例: "github_docs_server")

1. MCP サーバーのすべてのツールを使用できるようにするには、**[許可されたツール]** ドロップダウンを空のままにします。

1. **[ツールの作成]** ボタンを選択して、エージェントにツールを追加します。

## エージェントを Azure AI Foundry にデプロイする

1. デザイナー ビューで、左下隅にある **[Azure AI Foundry で作成]** ボタンを選択します。

1. デプロイが完了するまで待ちます。

1. VS Code ナビゲーション バーで、**[Azure リソース]** ビューを更新します。 これで、デプロイしたエージェントが **[エージェント]** サブセクションに表示されます。

## プレイグラウンドでエージェントをテストする

1. **[エージェント]** サブセクションで、デプロイしたエージェントを右クリックします。

1. コンテキスト メニューから **[プレイグラウンドを開く]** を選択します。

1. VS Code 内の新しいタブで、エージェント プレイグラウンドが開きます。

1. 次のようなテスト プロンプトを入力します。

   ```output
   Can you help me find documentation about Azure Container Apps and provide an example of how to create one?
   ```

1. メッセージを送信し、MCP サーバー ツールの認証と承認のプロンプトを確認します。
    - この演習では、プロンプトが表示されたら、**[認証なし]** を選択します。
    - MCP ツールの承認設定では、**[常に承認]** を選択できます。

1. エージェントの応答を確認し、MCP サーバー ツールを使用して外部情報を取得する方法に注意してください。

1. **[エージェントの注釈]** セクションで、エージェントによって使用される情報のソースを確認します。

## エージェントのサンプル コードを生成する

1. デプロイしたエージェントを右クリックし、**[コード ファイルを開く]** を選択するか、[エージェントの基本設定] ページで **[コード ファイルを開く]** ボタンを選択します。

1. ドロップダウンから目的の SDK (Python、.NET、JavaScript、または Java) を選択します。

1. 目的のプログラミング言語を選択します。

1. 好みの認証方法を選択します。

1. エージェントをプログラムで操作する方法を示す、生成されたサンプル コードを確認します。

このコードは、AI エージェントを活用するアプリケーションを構築するための開始点として使用できます。

## 会話の履歴とスレッドを表示する

1. **[Azure リソース]** ビューで、**[スレッド]** サブセクションを展開して、エージェントの操作中に作成された会話を表示します。

1. スレッドを選択すると、次の情報を示す **[スレッドの詳細]** ページが表示されます。
   - 会話内の個々のメッセージ
   - 実行情報と実行の詳細
   - エージェントの応答とツールの使用

1. **[実行情報の表示]** を選択すると、各実行に関する詳細な JSON 情報が表示されます。

## まとめ

この演習では、Azure AI Foundry VS Code 拡張機能を使用して、MCP サーバー ツールを使用する AI エージェントを作成しました。 エージェントは、モデル コンテキスト プロトコルを使用して外部データ ソースや API にアクセスできるため、最新情報を提供したり、さまざまなサービスと対話したりすることができます。 また、プレイグラウンドでエージェントをテストし、プログラムによる操作用のサンプル コードを生成する方法についても学習しました。

## クリーンアップ

Azure AI Foundry VS Code 拡張機能を調べ終えたら、不要な Azure コストが発生しないようにリソースをクリーンアップする必要があります。

### エージェントを削除する

1. Azure AI Foundry ポータルで、ナビゲーション メニューから **[エージェント]** を選択します。

1. エージェントを選択し、**[削除]** ボタンを選択します。

### モデルを削除する

1. VS Code で、**[Azure リソース]** ビューを更新します。

1. **[モデル]** サブセクションを展開します。

1. デプロイしたモデルを右クリックし、**[削除]** を選択します。

### 他のリソースを削除する

1. [Azure Portal](https://portal.azure.com)を開きます。

1. AI Foundry リソースを含むリソース グループに移動します。

1. **[リソース グループの削除]** を選択し、削除を確認します。