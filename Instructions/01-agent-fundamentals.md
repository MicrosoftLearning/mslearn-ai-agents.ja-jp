---
lab:
  title: AI エージェントの開発について学習する
  description: AI エージェントの開発を始める最初の手順として、Microsoft Foundry ポータルで Azure AI エージェント サービスを探索します。
---

# AI エージェントの開発を調べる

この演習では、Microsoft Foundry ポータルで Azure AI エージェント サービスを使用して、従業員の経費請求を支援する単純な AI エージェントを作成します。

この演習は約 **30** 分かかります。

> **注**: この演習で使用されるテクノロジの一部は、プレビューの段階または開発中の段階です。 予期しない動作、警告、またはエラーが発生する場合があります。

## Foundry プロジェクトとエージェントを作成する

まず、Foundry プロジェクトを作成しましょう。

1. Web ブラウザーで、[Foundry ポータル](https://ai.azure.com) (`https://ai.azure.com`) を開き、Azure 資格情報を使用してサインインします。 初めてサインインする場合に開かれるヒントまたはクイック スタートのペインを閉じ、必要に応じて、左上にある **[Foundry]** ロゴを使用してホーム ページに移動します。次の図のようなページが表示されます (**[ヘルプ]** ペインが表示される場合は閉じます)。

    ![Foundry ポータルのスクリーンショット。](./Media/ai-foundry-home-new.png)

    > **重要**: このラボでは、**新しい** Foundry エクスペリエンスを使用しています。
1. 上部のバナーで **[構築の開始]** を選択して、新しい Microsoft Foundry エクスペリエンスをお試しください。
1. プロンプトが表示されたら、**新しい**プロジェクトを作成し、プロジェクトに有効な名前を入力します。
1. **[詳細オプション]** を展開し、次の設定を指定します。
    - **Microsoft Foundry リソース**:"Foundry リソースの有効な名前"**
    - **[サブスクリプション]**:"*ご自身の Azure サブスクリプション*"
    - **リソース グループ**: *お手持ちのリソース グループを選択するか、新しいリソース グループを作成します*
    - **リージョン**: ***AI Foundry が推奨するもの***\** の中から選択します

    > \* 一部の Azure AI リソースは、リージョンのモデル クォータによって制限されます。 演習の後半でクォータ制限を超えた場合は、別のリージョンに別のリソースを作成する必要が生じる可能性があります。

1. **[作成]** を選択して、プロジェクトが作成されるまで待ちます。
1. プロジェクトが作成されたら、**[構築の開始]** を選択し、ドロップダウン メニューから **[エージェントの作成]** を選択します。
1. **[エージェント名]** を `expense-agent` に設定し、エージェントを作成します。

新しく作成したエージェントのプレイグラウンドが開きます。 使用可能なデプロイ済みモデルが既に選択されていることがわかります。

## エージェントを構成する

エージェントが作成されたので、エージェントを構成する準備ができました。 この演習では、企業の経費ポリシーに基づいて質問に回答するシンプルなエージェントを構成します。 経費ポリシー ドキュメントをダウンロードし、エージェントの*グラウンディング* データとして使用します。

1. 新しいブラウザー タブを開き、`https://raw.githubusercontent.com/MicrosoftLearning/mslearn-ai-agents/main/Labfiles/01-agent-fundamentals/Expenses_Policy.docx` から [Expenses_policy.docx](https://raw.githubusercontent.com/MicrosoftLearning/mslearn-ai-agents/main/Labfiles/01-agent-fundamentals/Expenses_Policy.docx) をダウンロードし、ローカルに保存します。 このドキュメントには、架空の Contoso 企業の経費ポリシーの詳細が含まれています。
1. 経費エージェントのプレイグラウンドが開いているブラウザー タブに戻ります。
1. **[手順]** を次の値に設定します。

    ```prompt
   You are an AI assistant for corporate expenses.
   You answer questions about expenses based on the expenses policy data.
   If a user wants to submit an expense claim, you get their email address, a description of the claim, and the amount to be claimed and write the claim details to a text file that the user can download.
    ```

    ![Foundry ポータル内の AI エージェントのセットアップ ページを示すスクリーンショット。](./Media/ai-agent-setup-new.png)

1. **[手順]** の下にある **[ツール]** セクションを展開します。
1. **[ファイルのアップロード]** を選択します
1. **[インデックス オプション]** と **[ベクター インデックス名]** は既定値のままにします。
1. **[ファイルの参照]** オプションを使用して、以前にダウンロードした **Expenses_policy.docx** ローカル ファイルをアップロードします。
1. ファイルが正常にアップロードされたら、**[添付]** を選択します。
1. **[ツール]** セクションに、新しい **[ファイル検索]** が一覧に表示され、そこに 1 つのファイルが含まれていることを確認します。
1. **[ツール]** セクションで、**[+ 追加]** を選択します。
1. **[ツールの選択]** ダイアログ ボックスで **[コード インタープリター]** を選択し、**[ツールの追加]** を選択します (コード インタープリターのファイルをアップロードする必要はありません)。

エージェントは、アップロードしたドキュメントをナレッジ ソースとして使用して、応答の*根拠*とします (つまり、このドキュメントの内容に基づいて質問に回答します)。 必要に応じてコード インタープリター ツールを使用し、独自の Python コードを生成して実行することでアクションを実行します。

## エージェントをテストする

エージェントを作成できたので、プレイグラウンド チャット内でテストしてみます。

1. プレイグラウンドのチャット入力フィールドにプロンプト `What's the maximum I can claim for meals?` を入力し、エージェントの応答を確認します。応答内容が、エージェントのセットアップ用ナレッジとして追加した経費ポリシー ドキュメントの情報に基づいているかチェックすること。

    > **注**: レート制限を超えたためにエージェントが応答に失敗した場合。 数秒待ってから、やり直してください。 サブスクリプションで使用可能なクォータが不足している場合は、モデルが応答できない可能性があります。 問題が解決しない場合は、**[モデル]** ページでモデルのクォータを増やしてみてください。

1. 次のフォローアッププロンプトを試してください: `I'd like to submit a claim for a meal.`。そして応答を確認します。 エージェントは、要求を送信するために必要な情報を求める必要があります。
1. エージェントにメール アドレス (例: `fred@contoso.com`) を指定します。 エージェントは、応答を確認し、経費請求に必要な残りの情報 (説明と金額) を要求する必要があります。
1. 請求と金額を説明するプロンプト (例: `Breakfast cost me $20`) を送信します。
1. エージェントは、コード インタープリターを使用して経費請求のテキスト ファイルを準備し、ダウンロードできるようにリンクを提供する必要があります。

    ![Foundry ポータル内の [エージェント プレイグラウンド] のスクリーンショット。](./Media/ai-agent-code-interpreter.png)

1. テキスト ドキュメントをダウンロードして開き、経費明細書の詳細を表示します。

## 省略可能:コードを調べる

プレイグラウンドでエージェントを試した後、それを独自のクライアント アプリケーションに統合することができます。 **[コード]** タブには、エージェントをプログラムで操作する方法を示すサンプル コードが表示されます。

1. エージェントのプレイグラウンドで、**[コード]** タブを選択してサンプル コードを表示します。

    ![エージェントのプレイグラウンドの [コード] タブを示すスクリーンショット。](./Media/ai-agent-code-tab.png)

1. Python コードをレビューします。 このコードは、次の方法を示しています。
    - Azure AI Projects SDK を使用してエージェントに接続する
    - エージェントにメッセージを送信する
    - 応答を取得して処理する
    
1. **[環境変数]** を選択すると、このコードを実行するために必要な環境変数が表示されます。
1. このコードは、作成したエージェントと対話する独自のクライアント アプリケーションを構築するための開始点として使用できます。
1. 必要に応じて **[Web の VS Code で開く]** を選択して、サンプル コードを実行する準備ができた構成済みワークスペースを起動します。

    > **注**:ワークスペースの準備には数分かかる場合があります。 ワークスペースに表示される手順に従って、コードを正常に実行します。

## クリーンアップ

これで演習が完了したので、不要なリソース使用を避けるために、作成したクラウド リソースを削除してください。

1. `https://portal.azure.com` で [Azure ポータル](https://portal.azure.com) を開き、この演習で使用したハブ リソースをデプロイしたリソース グループの内容を表示します。
1. ツール バーの **[リソース グループの削除]** を選びます。
1. リソース グループ名を入力し、削除することを確認します。
